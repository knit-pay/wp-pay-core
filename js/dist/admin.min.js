!function(o){function i(t){var a=this,i=o(t),s={};function e(){o.ajax({url:pronamicPayGatewayAdmin.rest_url,method:"GET",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",pronamicPayGatewayAdmin.nonce)},data:{gateway_id:o("#pronamic_gateway_id").val(),gateway_mode:o("#pronamic_ideal_mode").val()}}).done(function(t){o("#pronamic-pay-gateway-settings").html(t.meta_boxes.settings),o("#pronamic-pay-gateway-settings .pronamic-pay-tabs").pronamicPayTabs(),o("#pronamic-pay-gateway-settings .pronamic-pay-tip").each(function(){tippy(this,{content:o(this).attr("title"),arrow:!0,theme:"pronamic-pay"})})})}s.variantId=i.find("#pronamic_gateway_id"),s.extraSettings=i.find("div.extra-settings"),s.sectionHeaders=i.find(".gateway-config-section-header"),s.tabs=i.find(".pronamic-pay-tabs"),s.tabItems=i.find("ul.pronamic-pay-tabs-items"),s.pkCertFieldsToggle=o("#pk-cert-fields-toggle"),this.updateFields=function(){a.selectedVariant=s.variantId.find("option:selected"),a.settings=a.selectedVariant.data("pronamic-pay-settings"),i.find(".extra-settings").hide(),a.settingElements=[],o.isArray(a.settings)&&o.each(a.settings,function(t,a){i.find(".setting-"+a).show()}),i.find(".setting-"+a.selectedVariant.val()).show();var t=a.selectedVariant.text().split(" - ")[0].replace(/ \(.*\)/,"");s.tabItems.find(":visible").first().text(t).click(),o("#pronamic-pay-gateway-description").html(a.selectedVariant.attr("data-gateway-description")),0<s.pkCertFieldsToggle.length&&s.extraSettings.find("tr.pk-cert").hide()},this.updateRowBackgroundColor=function(){var t=s.extraSettings.find(".form-table tr");t.removeClass("even"),t.filter(":visible:even").addClass("even")},this.initTabs=function(){o.each(s.sectionHeaders,function(t,a){var i=o(a),e=i.find("h4").text(),n=i.parents("div")[0].className;s.tabItems.append(o("<li>"+e+"</li>").addClass(n).removeClass("pronamic-pay-tab"))}),s.tabItems.next().after(s.tabItems),s.tabItems.find("li").click(a.showTabSettings)},this.showTabSettings=function(){var t=o(this);s.extraSettings.hide().eq(t.index()).show()},this.togglePkCertFields=function(t){return t.preventDefault&&t.preventDefault(),s.pkCertFieldsToggle.hasClass("active")?(s.pkCertFieldsToggle.removeClass("active"),s.extraSettings.find("tr.pk-cert").hide()):(s.pkCertFieldsToggle.addClass("active"),s.extraSettings.find("tr.pk-cert").show()),a.updateRowBackgroundColor(),!1},o("#pronamic_gateway_id").change(e),o("#pronamic_ideal_mode").change(e),a.initTabs(),a.updateFields(),s.variantId.change(a.updateFields),s.pkCertFieldsToggle.click(a.togglePkCertFields)}o.fn.pronamicPayGatewayConfigEditor=function(){return this.each(function(){var t=o(this);if(!t.data("pronamic-pay-gateway-config-editor")){var a=new i(this);t.data("pronamic-pay-gateway-config-editor",a)}})};function e(t){var a=this,i=o(t),e={};e.tabItems=i.find("ul.pronamic-pay-tabs-items"),e.tabs=i.find(".pronamic-pay-tab"),e.tabItems=i.find("ul.pronamic-pay-tabs-items"),this.updateRowBackgroundColor=function(){var t=e.tabs.find(".form-table tr");t.removeClass("even"),t.filter(":visible:even").addClass("even")},this.showTab=function(){var t=o(this);e.tabItems.find("li").removeClass("active"),t.addClass("active"),e.tabs.hide().eq(t.index()).show(),a.updateRowBackgroundColor(),a.visibleTabItems=e.tabItems.find("li:visible"),a.activeTabItem=t},this.responsiveTabs=function(){if(960<o(window).width())e.tabs.hide(),a.activeTabItem?a.activeTabItem.click():e.tabItems.find("li:visible").first().click();else{if(!a.visibleTabItems)return;e.tabs.hide(),o.each(a.visibleTabItems,function(t,a){e.tabs.eq(o(a).index()).show()})}},e.tabItems.find("li").click(a.showTab),e.tabItems.find("li:visible").first().click(),o(window).resize(a.responsiveTabs)}o.fn.pronamicPayTabs=function(){return this.each(function(){var t=o(this);if(!t.data("pronamic-pay-tabs")){var a=new e(this);t.data("pronamic-pay-tabs",a)}})};function n(t){var a=o(t),i={};i.paymentMethods=a.find('select[name="pronamic_pay_test_payment_method"]'),this.updateInputVisibility=function(){var t=i.paymentMethods.val();""!==t&&a.find(".pronamic-pay-test-payment-method").hide().filter("."+t).show(),1===i.paymentMethods.find("option:selected").data("is-recurring")?o("#pronamic-pay-test-subscription").parents("tr").show():(o("#pronamic-pay-test-subscription").parents("tr").hide(),o("#pronamic-pay-test-subscription").prop("checked",!1).trigger("change"))},this.updateInputVisibility(),i.paymentMethods.change(this.updateInputVisibility),a.on("keydown",'input[name="test_amount"]',function(t){13===t.keyCode&&a.find('input[name="test_pay_gateway"]').click()})}o.fn.pronamicPayGatewayTest=function(){return this.each(function(){var t=o(this);if(!t.data("pronamic-pay-gateway-test")){var a=new n(this);t.data("pronamic-pay-gateway-test",a)}})};function s(t){var a=this,e=o(t),n={};n.amountMethod=e.find('select[name="_pronamic_payment_form_amount_method"]'),this.updateAmountsVisibility=function(){var t=n.amountMethod.val();"choices_only"===t||"choices_and_input"===t?e.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").show():e.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").hide()},this.maybeAddAmountChoice=function(){if(n.amountChoices=e.find('input[name="_pronamic_payment_form_amount_choices[]"]'),0===n.amountChoices.filter(function(){return""===this.value}).length){var t=n.amountChoices.last().closest("div"),a=t.clone(),i="_pronamic_payment_form_amount_choice_"+n.amountChoices.length;a.find("input").attr("id",i).val(""),a.find("label").attr("for",i),t.after(a)}},a.updateAmountsVisibility(),n.amountMethod.change(a.updateAmountsVisibility),e.on("keyup",'input[name="_pronamic_payment_form_amount_choices[]"]',function(){a.maybeAddAmountChoice()})}o.fn.pronamicPayFormOptions=function(){return this.each(function(){var t=o(this);if(!t.data("pronamic-pay-forms-options")){var a=new s(this);t.data("pronamic-pay-form-options",a)}})},o(document).ready(function(){o("#pronamic-pay-gateway-config-editor").pronamicPayGatewayConfigEditor(),o("#pronamic_payment_form_options").pronamicPayFormOptions(),o("#pronamic_gateway_test").pronamicPayGatewayTest(),o(".pronamic-pay-tabs").pronamicPayTabs(),o(".pronamic-pay-tip").each(function(){tippy(this,{content:o(this).attr("title"),arrow:!0,theme:"pronamic-pay"})})})}(jQuery);